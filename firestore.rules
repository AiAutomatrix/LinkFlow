rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Allow anyone to query the users collection to find a user by username,
    // and to get a user's public profile data.
    match /users/{userId} {
      allow get: if true;
      allow list: if true;
      
      // Only the authenticated user can update their own profile or create one.
      allow create, update: if request.auth != null && request.auth.uid == userId;

      // Rules for the 'links' subcollection
      match /links/{linkId} {
        // Allow anyone to read the list of links for a public profile.
        allow get: if true;
        allow list: if true;

        // Only the authenticated user can write to their own links.
        allow create, update, delete: if request.auth != null && request.auth.uid == userId;
      }
    }
  }
}
